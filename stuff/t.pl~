#!/usr/bin/perl

use strict;
use warnings;

use lib qw(../lib);
use Coro;
use Data::Dumper;
use AnyEvent::HTTP::LWP::UserAgent;

my @ua;
for (1..3) {
    push @ua, AnyEvent::HTTP::LWP::UserAgent->new(agent => "a$_");
}

my $urls = ['http://yandex.ru', 'http://google.ru', 'http://ya.ru'];


my @coro = map { my $i = $_; async {
    warn "coro $i started";
    my $resp = $ua->get($urls->[$i]);
    my $content = $resp->content;
    $content = substr($content, 0, 300);
    $content =~ s/\n/ /g;
    warn "coro $i content: [$content]\n";
    warn "coro $i finished";
} } 0..2;
$_->join for @coro;
